{"componentChunkName":"component---src-templates-post-js","path":"/posts/2024/02/jpa-one-to-many-and-cascade/","result":{"data":{"markdownRemark":{"id":"fe1e85d8-312d-521a-8ab7-eedebc407872","excerpt":"Spring Data JPA를 이용해서 엔티티(Entity) 설계를 진행하던 중 다대일(N:1) 또는 일대다(1:N…","html":"<p>Spring Data JPA를 이용해서 엔티티(Entity) 설계를 진행하던 중 다대일(N:1) 또는 일대다(1:N) 관계의 테이블에 대한 엔티티 관계 매핑을 어떻게 해야 하는지 몰라서 학습을 진행했다.\n학습한 내용을 정리하여 설명하겠다.</p>\n<p>상품 고시정보를 관리하기 위해 상품 정보 카테고리(product_information_category)와 상품 정보 항목(product_information_item) 테이블을 생성했다.\nproduct_information_category와 product_information_item 테이블은 일대다(1:N) 관계를 가진다. 즉, 1개의 상품 정보 카테고리는 여러 개의 정보 항목을 가진다.\n(이번 글에서 product_information_category의 순환 관계에 대해서는 무시하도록 하겠다.)</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/62a805a3eeff02bc0de4ee8a4592eba9/b8bf8/table.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAACFElEQVR42pVU2XLaQBDkQwzoBgkdYIzjCjaWjbgRIHHFlaRS+f+P6OwMrEqAKMhD1660sz1nb0lRDRShqugoV9SroPNze023ULpGZlp1BM0W/KAJ328iCGh/AP3XjdoJ6QkhfeTxUFbw2O5gs90j3WwRL5ZYrBLMxbpapUjXW3jCSbmiQdXMS0LaGGY9Axl1vnWx3n1hIxB+DvD9tYfuW4j3jwjRaCIifeTULwhpQySabopDg1GpKmh3uth9/cYsXuLt/SND+BlhPI1vE8oDAhm2Oy9YpalIc8Wk0/mC046XCYbjGTxRy0pRykWEsgzcmFYbtXqDbZyGz02hhqi6Wdzla4RVlVLX2IhsaC8dnY/MXYTSSJ7JCxQdkeehHKfjhLBofMg4T0g2tuOj4QZwvWa21m03T2iIS7VchDqDuk1r3hnZmJbNFznaI2QZsgjJ6NwrrZ7f4jPquqwhkR6+SX5aFvnJYFNdrJpzAdldysASxPTtNDzeE0zOrEjLXDMtA0UjJfj09MxyS5I1ZvOYZchSFPM5GI6EE+dQ8+MElK69NjI1ktvux0+h6b2QXR+vvZAV0x+MEQ0nokneyUjdJHzphkjWe1bKZBZjNJmJdcHoR6Osw/dFKFLuhRF+/fkrZJdiKdKW63g6Z01TTe+KUBaaauS4cvYOE0CwHRe2INMM6/YDmwd5L361jypR9f8jvBeS8B8Uc1B2SQYEmQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"[1] 일대다(1:N) 테이블\"\n        title=\"\"\n        src=\"/static/62a805a3eeff02bc0de4ee8a4592eba9/f058b/table.png\"\n        srcset=\"/static/62a805a3eeff02bc0de4ee8a4592eba9/c26ae/table.png 158w,\n/static/62a805a3eeff02bc0de4ee8a4592eba9/6bdcf/table.png 315w,\n/static/62a805a3eeff02bc0de4ee8a4592eba9/f058b/table.png 630w,\n/static/62a805a3eeff02bc0de4ee8a4592eba9/40601/table.png 945w,\n/static/62a805a3eeff02bc0de4ee8a4592eba9/78612/table.png 1260w,\n/static/62a805a3eeff02bc0de4ee8a4592eba9/b8bf8/table.png 1728w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">[1] 일대다(1:N) 테이블</figcaption>\n  </figure></p>\n<p>상품 정보 카테고리와 상품 정보 항목 테이블 관계를 엔티티로 매핑하기 위해서는 @OneToMany와 @ManyToOne을 사용하면 된다.</p>\n<p>product_information_item(상품 정보 항목) 기준에서 product_information_category(상품 정보 카테고리) 테이블과의 관계는 다대일(N:1)이다.\n그러므로 productInformationItem 엔티티에서 <code class=\"language-text\">@ManyToOne</code>으로 ProductInformationCategory 엔티티와 다대일 관계로 매핑한다.</p>\n<p>다대일 관계의 매핑은 다음과 같은 특징을 갖는다.</p>\n<ul>\n<li>다대일 또는 일대다 관계에서는 항상 다(N)쪽이 연관관계의 주인으로 설정된다.</li>\n<li><code class=\"language-text\">@ManyToOne</code>으로 설정된 엔티티는 영속 상태로 데이터 생성, 수정, 삭제를 진행할 수 있다.</li>\n<li>다(N) 테이블에서는 연관관계 테이블의 ID를 필드로 가지고 있다. (product_information_item 테이블에서 product_information_category의 ID를 관리하고 있다.)</li>\n</ul>\n<p>참고로 <code class=\"language-text\">@ManyToOne</code>에서 fetch 기본 타입은 즉시 로딩(eager)인 점을 주의하자.\n즉시 로딩으로 사용하여 데이터를 조회하는 경우, 다(N) 관계 쪽에 있는 결과 데이터 만큼 데이터가 증가하기 때문에 성능에 큰 영향을 미치게 된다.\n그러므로 <code class=\"language-text\">@ManyToOne</code>을 사용할 때는 <strong>반드시 fetch 타입을 lazy로 설정</strong>하도록 하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PROTECTED</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductInformationItem</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseDateTimeEntity</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"product_information_item_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"product_information_category_id\"</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">ProductInformationCategory</span> productInformationCategory<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ... 중략</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>product_information_category(상품 정보 카테고리) 기준에서 product_information_item(상품 정보 항목) 테이블과의 관계는 일대다(1:N)이다.\n그러므로 ProductInformationCategory 엔티티에서 <code class=\"language-text\">@OneToMany</code>로 productInformationItem 엔티티와 일대다 관계로 매핑한다.</p>\n<p>일대다 관계의 매핑은 다음과 같은 특징을 갖는다.</p>\n<ul>\n<li>다대일 또는 일대다 관계에서 일(1) 쪽은 연관관계 주인으로 설정하지 않기 때문에 <code class=\"language-text\">mappedBy = \"\"</code> 옵션을 설정한다.</li>\n<li><code class=\"language-text\">@OneToMany(mappedBy = \"\")</code>로 설정된 엔티티의 필드는 영속 상태로 관리되지 않기 때문에 데이터 읽기만 진행할 수 있다. (데이터베이스에 생성, 수정, 삭제가 일어나지 않는다.)</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PROTECTED</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductInformationCategory</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseDateTimeEntity</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"product_information_category_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"parent_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">ProductInformationCategory</span> parent<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"parent\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ProductInformationCategory</span><span class=\"token punctuation\">></span></span> children <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"productInformationCategory\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ProductInformationItem</span><span class=\"token punctuation\">></span></span> productInformationItems <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token comment\">// ... 중략</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>엔티티 검증을 위해서 \"'기타 재화' 상품 정보 카테고리와 기타 재화에 해당하는 상품 정보 항목 5개를 생성\"하는 시나리오를 테스트 코드로 작성해서 실행했다.\n상품 정보 카테고리(ProductInformationCategory) 엔티티에서 상품 정보 항목(productInformationItem)을 추가하여 생성했지만,\n상품 정보 카테고리(1) 엔티티에서 상품 정보 항목(N)은 영속 상태가 아니기 때문에 데이터 저장이 되지 않아 테스트는 실패했다.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ff143f4898c009ee247f28873dfe2a10/d1442/test-fail.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 148.7341772151899%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAABYlAAAWJQFJUiTwAAAErElEQVR42nVWy3IbNxDUyVU5SCedZFPcB14L7JtLUhQlStHDjlIxyzmkfM8P8OQfyLealco3iMKkB0takk2zqgtLYNnomWkMeHBzdvP2bvl5tfjrn9Xi05fV9O7v1ezm86qY3q3a+QyYhrGedquiblez+fVqsbhZLa5v8LxYFR3m23blXA10g4PStX/k7YyaduHP5u/p7PKBZhd3NDmbUdU0ZIuKHKC0pVQYkhgZ/F0qzEnjlc68dRUVRbM80M59lCojEQ0fc2s3eVFtTOY2QqpNIoCEkW5Oh8lmcBpv3g2iV8Dc49t3w0eT5ZRXo08H1tqlsTklsfDGWNImJyENgYCiWAQMI0H4YZjbA481n9mC8rz68yDVeqmNIy2kt5klXmC4vCLLyBwZrHOYSSr3EQfCoJAJoyhdCoQcxSkIDeltbrR2fZ6QNy0sGQlijCrNoDj9gVAhOmkMCNN0yWEarX1ZOrIORNaS4BeyDEnX2ExSnCgo1AFxIl/CR5wuKJRyS8hKEijUmCyrFtL7sPU2pxwu55UJTqFu+BqeVfJ6ImVPKGSG3CRYiAPRZDqn8WRGo25KxbilrC23xfl5UYL6ZEeIHPICEwplgsqiaihn/+XwmkWYoi8INt5LyKl5VqhYYewlJjNTbJFTlhWhONaWFHKEYin2LIcvJbF/kS6POYT8ncJQKVSxhONFokmmJoxC6PBDDvmlssELhYxU7CEUbBHT/zhKdqZG4ocpxZFE4SSlMarNSL/BD1HQH3IYCJG/vvwhlOBJhZC1ggc1rIWRVaesHGFv4aNAqF7nkGWzIiZsRx114zOqR2M0iBE1oynmplTVXVDFqnF+A1hIqLLYU2V+kb1XcoXLhrIcxbBsdhSJgeJkriTuLLwxR8GmDlXeRxgjb3yu67aj0QSK2hFpnOUMzYMJDFcd6ztSTgcb+6eErHAwiEjgTNuuokj0XQZtCojD2iA8P6P3YfIyZL3kxokXsYAXGHFCsZLBa6f7T0ePYPTYY7MXRUG3MchNKjPPown5KUnB3DE2il43gn3wDPZqUAhly248pfni1p9ffaDZ4p5GZ9c0Of+VJuMZlSUfw+1RLPfCb7EjTJcNbPL7w72/e/9AN3cfAjo0By0Utc04PNftOJxxbh7DYHy5g49hbm7GfQ4Rct6r8FXTEYN/7PIa+RNUYGdGaF185Pq8vUQ4ehzFtxy6oka7r8MuAfjONuEDn+O5vxZ66zDxrhee9p2b3dGHzIQpqlzWIybyTLwDe427Tp4jT1DLvmNw8tlzoSmjsjuFvFkg1LikOMzvCfmSqt2CquI2QNlF6DDhktqBfQi7DUHIUfSEzW8fq8ktH68nVzRM6hGmN67wOlF+Kp0fwVJjaf1EYNTOl1nha1f5i/HcX86unuq8eWKFqVJ8L3eo8oxz5XdW4CIYziUupgscrzm6zBzjeRhzOkcqLusxXU3mdNlMfaOsxxXa33pJktyiIP9lrv6KMNf467HGX481/j2slVDrTNm1TBWeTRgz5dbo5usMa4a/C/MVWLu8/NeY/P4An18OD48loI6Pn3F4eIgRODkJz2+2OOS145PteKzebMejoyPBXP8DoQ8jlUSVKMsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"상품 정보 항목(N) 데이터 추가되지 않아서 테스트 실패\"\n        title=\"\"\n        src=\"/static/ff143f4898c009ee247f28873dfe2a10/f058b/test-fail.png\"\n        srcset=\"/static/ff143f4898c009ee247f28873dfe2a10/c26ae/test-fail.png 158w,\n/static/ff143f4898c009ee247f28873dfe2a10/6bdcf/test-fail.png 315w,\n/static/ff143f4898c009ee247f28873dfe2a10/f058b/test-fail.png 630w,\n/static/ff143f4898c009ee247f28873dfe2a10/40601/test-fail.png 945w,\n/static/ff143f4898c009ee247f28873dfe2a10/78612/test-fail.png 1260w,\n/static/ff143f4898c009ee247f28873dfe2a10/d1442/test-fail.png 2538w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">상품 정보 항목(N) 데이터 추가되지 않아서 테스트 실패</figcaption>\n  </figure></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PROTECTED</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductInformationCategory</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseDateTimeEntity</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// ... 중략</span>\n\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"productInformationCategory\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ProductInformationItem</span><span class=\"token punctuation\">></span></span> productInformationItems <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// read-only</span>\n    \n    <span class=\"token comment\">// ... 중략</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그러면 부모 엔티티(상품 정보 카테고리)에서 데이터 읽기만 가능한 자식 엔티티(상품 정보 항목)에 데이터를 저장하고 싶으면 어떻게 해야 할까?\nCASCADE 옵션으로 자식 엔티티도 영속 상태로 만들어주면 된다. CASCADE 옵션은 6개가 있으며 다음 표와 같다.</p>\n<table>\n<thead>\n<tr>\n<th>옵션</th>\n<th>설명</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>CascadeType.ALL</td>\n<td>부모 엔티티의 상태 변경 또는 삭제 시, 관련된 자식 엔티티도 모두 동일한 작업을 수행한다.</td>\n</tr>\n<tr>\n<td>CascadeType.PERSIST</td>\n<td>부모 엔티티가 영속화(persist)될 때, 관련된 자식 엔티티도 함께 영속화된다.</td>\n</tr>\n<tr>\n<td>CascadeType.MERGE</td>\n<td>부모 엔티티가 병합(merge)될 때, 관련된 자식 엔티티도 함께 병합된다.</td>\n</tr>\n<tr>\n<td>CascadeType.REMOVE</td>\n<td>부모 엔티티가 제거(remove)될 때, 관련된 자식 엔티티도 함께 제거된다.</td>\n</tr>\n<tr>\n<td>CascadeType.REFRESH</td>\n<td>부모 엔티티가 새로고침(refresh)될 때, 관련된 자식 엔티티도 함께 새로고침된다.</td>\n</tr>\n<tr>\n<td>CascadeType.DETACH</td>\n<td>부모 엔티티가 분리(detach)될 때, 관련된 자식 엔티티도 함께 분리된다.</td>\n</tr>\n</tbody>\n</table>\n<p>상품 정보 카테고리(부모 엔티티)에서 상품 정보 항목(자식 엔티티)에 CascadeType.ALL 옵션을 정의하고, 테스트 코드를 다시 실행했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PROTECTED</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductInformationCategory</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseDateTimeEntity</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// ... 중략</span>\n\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"productInformationCategory\"</span><span class=\"token punctuation\">,</span> cascade <span class=\"token operator\">=</span> <span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ALL</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ProductInformationItem</span><span class=\"token punctuation\">></span></span> productInformationItems <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// read-write</span>\n    \n    <span class=\"token comment\">// ... 중략</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cf2e586ba49cf322f9350bb9d3f55352/df5d6/test-success.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 150%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAABYlAAAWJQFJUiTwAAAEoElEQVR42oVWTW/jNhD1qe3BOaUFskAdSxTFT4mSLct2rKTeLJpiWzR7Kdprf8ACC++1p/7Xdt0fsQ6nM6QUO+m2NfBA6utx5s3j0KNts/3y7sef3t3+/Pv77375bXdz/3a3ff3rbnFzv1tub3bzbhmxXu7Kar5bd9vdzfZVQHez3VXzxa5qmve6qN9xzr8aSWs3Rb32xl1D1Wy9qTdg3RJ0MUc44EJDliuEBMYl5NIcEZ5JL6QCW9Zgq6YbCWE7Ic2BpcmDkvJjlvEDy/JDxsWBMXHIGD9keM1zdUhx/vUkeYLJZfqRRm3Kg2ua65GwttO2gGnKwWjltS5ASAtSFaBojlHI3IDKbRgF15AkHC6nbIBHUkBCcM4hoRAUISRIaK3yQknIRATLBSQMP75kMMWPp0mGZNkpWU/IAqFB3UaMsY7nuGqaYWTGW1fjgwIkRpcLFXTiOJJ+tOgzskBII2nKhCBCgYTq8aHWJbSrDbTLK1gs1uDaOZjGActEiPDfCGlB5DoSxpdTT/N6toCqbsBVcxClhcwqSPOcngOlR5oRCY2IoGFGhMcIdXgBK+u1KkFTQSQCR4mpUNRUoMEqXMYF6Du850V//yRCHVbPufKuqCHP1CN4772UYYTJMdXJND1JOYspn0YYws6klyoWiAowTaNmVOFkyiFFu7BUQJrmqGkedEV4ep9xMRCyLheG0gWhsMpFhR60mGLZp4oIMjgwCIl+zLnpvWpp9BlXYTc9IaSUEF6hZZqmhUV7BfN2BfV8CbNmBQ1e05w+pOhxdyDSx5RPCI+2mSbM51Kj42so3Az3cgXKGPRlGYyrjQNtXRiHQiRp7mNB5T8JcWVPadSzFiNaYWQtEtpIhJFrWwbDG1tBUc6CHPTNJwmDD5MsekpKsG0NqRC915IewXd9uvHeE2MPhCRq+GCa+EsckxRfkFhFkUdrkJEHM5/ukhNjh4oTIW78rkS9ynoBs7bzzeoa6uYKqvkVmHIetApAKU57oTiOXgRXFGhsFgltNYOrb+6ge/m9X1/fQbt5Bc36FsrZKlR71izB4VbEjh0aaeHmoWg9PN03ZQWTSHjZGYcFWL+G7vaN39y+gc3Le1h0P2DnXkCJFacPaF9XmAXNCySN1w0WyHlyAC00GSI0aA8ydHhoozUsrkgWopdJklBVE5tuykTwYtiOfVEog7CXHwnpTChr348hHbICgdK2uMeHKj9vX+QQSvn/CdFOJDx5MxxW/QJENFgHESKk6P+TkKDonAj6NUE/MjzpRjJQ6gT0cOihJNNj+xqq9zxCsgNpS0UgkJZ0HXpiHo8H6jbkwRNC1rn604SsT7HBo4AiJAICaXayc/qUy0goqruuWn77YAsq/eyhJ/XkL0oHCailhZG60TRuz1M80D0k9MHYDI++CnfGYNLBsCQDnc2UIqXqei9S9NSQKeV4WvJYZZIi1zejyWSywC7yp7LuL/ThB9Rib4p6jz7c4/09NtB9JuxeaJqbcI39c88DNOEDyrLHDvQH/mloR/j7/OzsLB+Px/r8/FyNxwgcaX7+4kUYPxuP43X/PI7jAJpfXFxo4kCuL/4GfI4hAy34jbIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"상품 정보 항목(N) 데이터 추가되어 테스트 성공\"\n        title=\"\"\n        src=\"/static/cf2e586ba49cf322f9350bb9d3f55352/f058b/test-success.png\"\n        srcset=\"/static/cf2e586ba49cf322f9350bb9d3f55352/c26ae/test-success.png 158w,\n/static/cf2e586ba49cf322f9350bb9d3f55352/6bdcf/test-success.png 315w,\n/static/cf2e586ba49cf322f9350bb9d3f55352/f058b/test-success.png 630w,\n/static/cf2e586ba49cf322f9350bb9d3f55352/40601/test-success.png 945w,\n/static/cf2e586ba49cf322f9350bb9d3f55352/78612/test-success.png 1260w,\n/static/cf2e586ba49cf322f9350bb9d3f55352/df5d6/test-success.png 2514w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">상품 정보 항목(N) 데이터 추가되어 테스트 성공</figcaption>\n  </figure></p>\n<p>상품 정보 항목이 정상적으로 추가되어 테스트 코드가 성공했다.\n여기서 알 수 있는 내용은 부모 엔티티에서 자식 엔티티의 데이터 관리(생성, 수정, 삭제)가 필요하지 않은 경우에는 영속성 전이를 하지 않고, 읽기만 수행해도 된다.\n그리고 추가로 부모 엔티티에서 자식 엔티티에 접근할 필요가 없는 경우에는 자식 엔티티를 정의할 필요가 없다.</p>\n<p>이해를 돕기 위해 일대다(1:N) 관계의 카테고리(Category)와 상품(Product) 테이블이 있다고 가정하여 설명하겠다.</p>\n<ul>\n<li>1-1) 카테고리는 부모 엔티티가 되며, 상품 엔티티를 <code class=\"language-text\">@OneToMany(mappedBy = \"\")</code>으로 정의한다.</li>\n<li>1-2) 부모 엔티티(카테고리)에서 자식 엔티티(상품)는 읽기만 가능하다. (생성, 수정, 삭제가 불가능하다)</li>\n<li>2-1) 상품 엔티티는 연관관계 주인이 되며, 카테고리 엔티티를 <code class=\"language-text\">@ManyToOne(fetch = FetchType.LAZY)</code>로 정의한다.</li>\n<li>2-2) 자식 엔티티(상품)에서 부모 엔티티(카테고리)를 조회, 생성, 수정, 삭제할 수 있다.</li>\n</ul>\n<p>만약 카테고리 정보를 넣어서 상품을 생성해야 하지만, 카테고리로 상품 정보 조회 기능이 필요 없다면 부모 엔티티(카테고리)에서 자식 엔티티(상품)를 정의할 필요가 없다.\n즉, 상품 엔티티를(<code class=\"language-text\">private List&lt;Product> products;</code>) 정의할 필요가 없으며 필요한 경우에만 정의하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PROTECTED</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Product</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token comment\">// (2-1, 2-2)</span>\n    <span class=\"token comment\">// 자식 엔티티는 연관관계 주인이므로, 부모 엔티티를 ManyToOne으로 정의한다. (부모 엔티티 조회, 생성, 수정, 삭제가 가능)</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"category_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Category</span> category<span class=\"token punctuation\">;</span>\n    \n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PROTECTED</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Category</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token comment\">// (1-1, 1-2)</span>\n    <span class=\"token comment\">// 1. 부모 엔티티에서 자식 엔티티 관리가 필요 없다면, 정의하지 않는다. (자식 엔티티 조회, 생성, 수정, 삭제 불가)</span>\n    <span class=\"token comment\">// 2. 카테고리(부모 엔티티)에서 상품(자식 엔티티) 조회가 필요한 경우 정의하지만,</span>\n    <span class=\"token comment\">//    카테고리를 생성할 때 상품을 함께 생성하는 시나리오가 없는 경우 CASCADE 옵션을 정의하지 않는다. (자식 엔티티 조회 가능)</span>\n    <span class=\"token comment\">//    (참고, 일반적으로 카테고리 생성할 때, 상품을 함께 생성하는 시나리오는 없다. 상품을 생성할 때 카테고리를 추가하는 시나리오가 일반적이다.)</span>\n    <span class=\"token comment\">// @OneToMany(mappedBy = \"category\")</span>\n    <span class=\"token comment\">// private List&lt;Product> products;</span>\n    \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이상으로 JPA에서 다대일(N:1) 또는 일다대(1:N) 관계에서 @ManyToOne, @OneToMany 연관관계 매핑을 알아봤다.\n그리고 CASCADE 옵션으로 부모 엔티티에서 자식 엔티티 관리를 위한 영속성 전이에 대해서도 알아봤다.</p>","frontmatter":{"title":"JPA에서 @OneToMany 매핑과 CASCADE 옵션","description":null,"createdAt":"2024-02-26","editedAt":"2024-02-26"}},"previous":{"fields":{"slug":"/posts/2024/02/mysql-char-vs-varchar/"},"frontmatter":{"title":"MySQL CHAR와 VARCHAR 타입 비교"}},"next":{"fields":{"slug":"/posts/2024/03/spring-boot-login-api-1/"},"frontmatter":{"title":"Spring Boot Login API 개발 1 - 카카오 로그인 연동"}}},"pageContext":{"id":"fe1e85d8-312d-521a-8ab7-eedebc407872","previousPostId":"53435063-5a87-53ff-af96-41db35995ce3","nextPostId":"d6f03de7-f599-5880-8261-25c4b30a6bdd"}},"staticQueryHashes":["3764592887"],"slicesMap":{}}